---
title: "Homework8"
author: "John Murphy"
date: "2023-11-19"
output: html_document
---

```{r}
library(readr)
#names=c("Date", "US_ALL_SECTORS", "US_ELECTRIC_UTILITY", "US_INDEPENDENT_POWER_PRODUCERS", "US_ALL_COMMERCIAL", "US_ALL_INDUSTRIAL")
Electricity_Data_US <- read_csv('electricity_data_US.csv')
Electricity_Data_US_ts <- ts(Electricity_Data_US$'US_ALL_SECTORS', frequency = 12, start = c(2001,1), names = c("Date", "US_ALL_SECTORS"))
Electricity_Data_US_ts
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

### Load the Necessary Libraries
```{r}
library(fpp)
library(fpp2)
library(TTR)
```

## Plot the Time-Series Data
```{r}
head(Electricity_Data_US_ts)
plot(Electricity_Data_US_ts)
```

### Acf on Time-Series Data
```{r}
Acf(Electricity_Data_US_ts)
```

# ADF test says differences is required if p-value is > 0.05
```{r}
adf.test(Electricity_Data_US_ts)
```

# Kipps test says differences is required if p-value is < 0.05
```{r}
kpss.test(Electricity_Data_US_ts)
```

# There is also a function to tell you how much differences you need to do!
# NSDIFFS only works for seasonal data - this is the one we use for this data
```{r}
nsdiffs(Electricity_Data_US_ts)
```

# However NDIFFS works with non-seasonal data - this is the one we do NOT use for this data
```{r}
ndiffs(Electricity_Data_US_ts)
```

#tsdisplay plots ACF,PACF and timeseries plot together. How cool!  Very cool!
```{r}
tsdisplay(Electricity_Data_US_ts)
```

# take first order differences as indicated by ndiffs function
# diff function can help you do this
```{r}
Electricity_Data_US_ts_diff1 <- diff(Electricity_Data_US_ts, differences=1)
```

## Plot the Time-Series Data
```{r}
head(Electricity_Data_US_ts_diff1)
plot(Electricity_Data_US_ts_diff1)
```

### Acf on Time-Series Data
```{r}
Acf(Electricity_Data_US_ts_diff1)
```

# See if more differences is needed and how plots look
```{r}
tsdisplay(Electricity_Data_US_ts_diff1)
ndiffs(Electricity_Data_US_ts_diff1)
kpss.test(Electricity_Data_US_ts_diff1)
adf.test(Electricity_Data_US_ts_diff1)
```

# we now know that the d part in ARIMA(p,d,q) is 1. Now lets find p and q
```{r}
acf(Electricity_Data_US_ts_diff1, lag.max=20)
Acf(Electricity_Data_US_ts_diff1, lag.max=20)
```

# Difference between acf and Acf is that Acf does not plot a spike at lag0.
# Did you notice this?  Yes!
# plot a correlogram
```{r}
Acf(Electricity_Data_US_ts_diff1, lag.max=20)
```

# get the autocorrelation values
```{r}
Acf(Electricity_Data_US_ts_diff1, lag.max=20,plot=FALSE)
```

# plot a partial correlogram
```{r}
Pacf(Electricity_Data_US_ts_diff1, lag.max=20)
```

# get the partial autocorrelation values
```{r}
Pacf(Electricity_Data_US_ts_diff1, lag.max=20, plot=FALSE)
```

# using PACF, Lags 1, 2, 3, 4, 5, 8, 9, 10, 11, and 12 show significant values for p value (both positive and negative)
# the ACF plot provided appears to have significant values at multiple lags. This could suggest a higher-order MA process or a complex seasonal pattern.

# Principle of Parsimony says choose one with the least number of parameters
# You can also be lazy and just call auto.arima and let it do the work for you.
```{r}
auto.arima(Electricity_Data_US_ts)
```

# ARIMA Values: ARIMA(1,0,2)(2,1,2)[12] with drift 

# or save the model. BIC and AIC is also given as values.
```{r}
auto_fit <- auto.arima(Electricity_Data_US_ts)
auto_fit
```

## sigma^2 = 78464937:  log likelihood = -2558.54
## AIC=5135.07   AICc=5135.84   BIC=5166.51

# There are lot of attributes. ?auto.arima will tell you about them
```{r}
attributes(auto_fit)
```

# or use ARIMA (1,0,2) and pass the values
```{r}
Electricity_Data_US_ts_arima <- arima(Electricity_Data_US_ts, order=c(1,0,2)) # fit an ARIMA(1,0,2) model
Electricity_Data_US_ts_arima
```

# or use ARIMA (2,1,2)  and pass the values
```{r}
Electricity_Data_US_ts_arima <- arima(Electricity_Data_US_ts, order=c(2,1,2)) # fit an ARIMA(2,1,2) model
Electricity_Data_US_ts_arima
```

# or use ARIMA (1,0,2). It will tell you the difference between them.
```{r}
fit_Arima_1 <- Arima(Electricity_Data_US_ts, order=c(1,0,2))
fit_Arima_1
```

# or use ARIMA (2,1,2). It will tell you the difference between them.
```{r}
fit_Arima_2 <- Arima(Electricity_Data_US_ts, order=c(2,1,2))
fit_Arima_2
```

### Arima and arima are similar except arima does not allow for the constant c
### unless d=0, and it does not return everything required for the forecast()
### function. Finally, it does not allow the estimated model to be applied
### to new data (which is useful for checking forecast accuracy).
### Consequently, it is recommended that you use Arima() instead
### Lets call forecast. You can pass the confidence interval

# Forecast with ARIMA (1,0,2).
```{r}
forecast(fit_Arima_1,h=5,level=c(99.5))
```

# Forecast with ARIMA (2,1,2).
```{r}
forecast(fit_Arima_2,h=5,level=c(99.5))
```

# or use defaults with ARIMA (1,0,2).
```{r}
forecast(fit_Arima_1,h=5)
```

# or use defaults with ARIMA (2,1,2).
```{r}
forecast(fit_Arima_2,h=5)
```

# Or Plot it to see how it looks for ARIMA (1,0,2). Increase h and plot it.
```{r}
plot(forecast(fit_Arima_1, h=5))
```

# Or Plot it to see how it looks for ARIMA (2,1,2). Increase h and plot it.
```{r}
plot(forecast(fit_Arima_2, h=5))
```

# ARIMA (1,0,2)
## We are not finished till we do some residual analysis
## ACF plot, Box Ljung test, Histogram and Timeseries plot
```{r}
Acf(fit_Arima_1$residuals)
Box.test(residuals(fit_Arima_1), lag=20, type="Ljung")
plot.ts(residuals(fit_Arima_1))
hist(fit_Arima_1$residuals)
```

# Or do all the plots in one!
```{r}
tsdiag(fit_Arima_1)
```

# ARIMA (2,1,2).
## We are not finished till we do some residual analysis
## ACF plot, Box Ljung test, Histogram and Timeseries plot
```{r}
Acf(fit_Arima_2$residuals)
Box.test(residuals(fit_Arima_2), lag=20, type="Ljung")
plot.ts(residuals(fit_Arima_2))
hist(fit_Arima_2$residuals)
```

# Or do all the plots in one!
```{r}
tsdiag(fit_Arima_2)
```

# You can always simulate what ACF and PACF for ARIMA looks like
```{r}
sim.ar <- arima.sim(list(ar=c(0.4,0.4)),n=1000)
sim.ma <- arima.sim(list(ma=c(0.6,-0.4)),n=1000)
par(mfrow=c(2,2))
Acf(sim.ar)
Acf(sim.ma)
Pacf(sim.ar)
Pacf(sim.ma)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
